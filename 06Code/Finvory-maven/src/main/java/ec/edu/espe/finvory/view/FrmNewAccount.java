package ec.edu.espe.finvory.view;

import ec.edu.espe.finvory.FinvoryApp;
import ec.edu.espe.finvory.controller.AuthenticatorController;
import ec.edu.espe.finvory.controller.FinvoryController;
import ec.edu.espe.finvory.model.Address;
import ec.edu.espe.finvory.utils.ValidationUtils;
import ec.edu.espe.finvory.utils.GoogleAuthService;
import java.awt.Color;
import java.util.HashMap;
import javax.swing.JOptionPane;

/**
 *
 * @author Mathews Pastor, The POOwer Rangers Of Programming
 */
public class FrmNewAccount extends javax.swing.JFrame {

    private FinvoryController controller;
    private final Color ERROR_COLOR = Color.RED;
    private final Color DEFAULT_COLOR = Color.BLACK;

    /**
     * Creates new form FrmNewAccount
     */
    public FrmNewAccount(FinvoryController controller) {
        this.controller = controller;
        initComponents();
        ButtonStyles.applyPrimaryStyle(btnCancelCompany);
        ButtonStyles.applyPrimaryStyle(btnRegisterCompany);
        ButtonStyles.applyPrimaryStyle(btnRegisterPersonal);
        this.setLocationRelativeTo(null);
        this.setResizable(false);
        FinvoryApp.setIcon(this);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel2 = new javax.swing.JPanel();
        lblCompanyName = new javax.swing.JLabel();
        txtCompanyName = new javax.swing.JTextField();
        lblRuc = new javax.swing.JLabel();
        txtCompanyRuc = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        lblCountry = new javax.swing.JLabel();
        txtCountry = new javax.swing.JTextField();
        lblCity = new javax.swing.JLabel();
        txtCity = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        txtStreet = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        txtCompanyUserName = new javax.swing.JTextField();
        jLabel9 = new javax.swing.JLabel();
        btnRegisterCompany = new javax.swing.JButton();
        passCompanyPassword = new javax.swing.JPasswordField();
        lblPhone = new javax.swing.JLabel();
        txtPhone = new javax.swing.JTextField();
        lblEmail = new javax.swing.JLabel();
        txtEmail = new javax.swing.JTextField();
        btnCancelCompany = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        lblPersonalFullName = new javax.swing.JLabel();
        txtPersonalFullName = new javax.swing.JTextField();
        lblPersonalUser = new javax.swing.JLabel();
        txtPersonalUserName = new javax.swing.JTextField();
        lblPersonalPassword = new javax.swing.JLabel();
        btnRegisterPersonal = new javax.swing.JButton();
        passPersonalPassword = new javax.swing.JPasswordField();
        jPanel3 = new javax.swing.JPanel();
        lblTitle = new javax.swing.JLabel();
        lblType = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jTabbedPane1.setBackground(new java.awt.Color(224, 224, 224));
        jTabbedPane1.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N

        jPanel2.setBackground(new java.awt.Color(224, 224, 224));

        lblCompanyName.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 12)); // NOI18N
        lblCompanyName.setText("Nombre de la Empresa:");

        txtCompanyName.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                txtCompanyNameMouseEntered(evt);
            }
        });

        lblRuc.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        lblRuc.setText("RUC:");

        txtCompanyRuc.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                txtCompanyRucMouseEntered(evt);
            }
        });

        jLabel4.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        jLabel4.setText("Dirección:");

        lblCountry.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        lblCountry.setText("País:");

        txtCountry.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                txtCountryMouseEntered(evt);
            }
        });

        lblCity.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        lblCity.setText("Ciudad:");

        jLabel7.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        jLabel7.setText("Calle:");

        jLabel8.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        jLabel8.setText("Usuario:");

        jLabel9.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        jLabel9.setText("Contraseña:");

        btnRegisterCompany.setBackground(new java.awt.Color(0, 123, 0));
        btnRegisterCompany.setFont(new java.awt.Font("Perpetua", 1, 14)); // NOI18N
        btnRegisterCompany.setForeground(new java.awt.Color(242, 242, 242));
        btnRegisterCompany.setText("REGISTRAR");
        btnRegisterCompany.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btnRegisterCompany.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRegisterCompanyActionPerformed(evt);
            }
        });

        lblPhone.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        lblPhone.setText("Celular/Telefono:");

        txtPhone.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                txtPhoneMouseEntered(evt);
            }
        });

        lblEmail.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        lblEmail.setText("Email:");

        txtEmail.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                txtEmailMouseEntered(evt);
            }
        });

        btnCancelCompany.setBackground(new java.awt.Color(0, 123, 0));
        btnCancelCompany.setFont(new java.awt.Font("Perpetua", 1, 14)); // NOI18N
        btnCancelCompany.setForeground(new java.awt.Color(242, 242, 242));
        btnCancelCompany.setText("CANCELAR");
        btnCancelCompany.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btnCancelCompany.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCancelCompanyActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblCompanyName, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(lblRuc, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 47, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lblPhone, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(lblEmail, javax.swing.GroupLayout.Alignment.TRAILING))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txtCompanyName, javax.swing.GroupLayout.PREFERRED_SIZE, 179, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addComponent(txtEmail, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 115, Short.MAX_VALUE)
                                .addComponent(txtPhone, javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(txtCompanyRuc, javax.swing.GroupLayout.Alignment.LEADING))))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(13, 13, 13)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(lblCountry, javax.swing.GroupLayout.PREFERRED_SIZE, 37, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel7))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addComponent(txtCountry, javax.swing.GroupLayout.PREFERRED_SIZE, 91, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(lblCity)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtCity, javax.swing.GroupLayout.PREFERRED_SIZE, 102, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(txtStreet, javax.swing.GroupLayout.PREFERRED_SIZE, 251, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jLabel4))
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addGap(101, 101, 101)
                            .addComponent(btnRegisterCompany)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 33, Short.MAX_VALUE)
                            .addComponent(btnCancelCompany))
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addContainerGap()
                            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel8)
                                .addComponent(jLabel9))
                            .addGap(14, 14, 14)
                            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                .addComponent(txtCompanyUserName, javax.swing.GroupLayout.DEFAULT_SIZE, 170, Short.MAX_VALUE)
                                .addComponent(passCompanyPassword)))))
                .addContainerGap(82, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(29, 29, 29)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCompanyName)
                    .addComponent(txtCompanyName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(15, 15, 15)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtCompanyRuc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblRuc))
                .addGap(18, 18, 18)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblPhone)
                    .addComponent(txtPhone, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblEmail)
                    .addComponent(txtEmail, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel4)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCountry)
                    .addComponent(txtCountry, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblCity)
                    .addComponent(txtCity, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel7)
                    .addComponent(txtStreet, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(30, 30, 30)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(txtCompanyUserName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel9)
                    .addComponent(passCompanyPassword, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(36, 36, 36)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnRegisterCompany)
                    .addComponent(btnCancelCompany))
                .addGap(49, 49, 49))
        );

        jTabbedPane1.addTab("Cuenta Empresa", jPanel2);

        jPanel1.setBackground(new java.awt.Color(224, 224, 224));

        lblPersonalFullName.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        lblPersonalFullName.setText("Nombre Completo:");

        txtPersonalFullName.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                txtPersonalFullNameMouseEntered(evt);
            }
        });
        txtPersonalFullName.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtPersonalFullNameActionPerformed(evt);
            }
        });

        lblPersonalUser.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        lblPersonalUser.setText("Usuario:");

        lblPersonalPassword.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        lblPersonalPassword.setText("Contraseña:");

        btnRegisterPersonal.setBackground(new java.awt.Color(0, 123, 0));
        btnRegisterPersonal.setFont(new java.awt.Font("Perpetua", 1, 14)); // NOI18N
        btnRegisterPersonal.setForeground(new java.awt.Color(242, 242, 242));
        btnRegisterPersonal.setText("REGISTRAR");
        btnRegisterPersonal.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btnRegisterPersonal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRegisterPersonalActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(16, 16, 16)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblPersonalFullName)
                            .addComponent(lblPersonalPassword)
                            .addComponent(lblPersonalUser))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txtPersonalFullName, javax.swing.GroupLayout.PREFERRED_SIZE, 216, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addComponent(passPersonalPassword, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 174, Short.MAX_VALUE)
                                .addComponent(txtPersonalUserName, javax.swing.GroupLayout.Alignment.LEADING))))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(149, 149, 149)
                        .addComponent(btnRegisterPersonal)))
                .addContainerGap(40, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(57, 57, 57)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblPersonalFullName)
                    .addComponent(txtPersonalFullName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblPersonalUser)
                    .addComponent(txtPersonalUserName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblPersonalPassword)
                    .addComponent(passPersonalPassword, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(76, 76, 76)
                .addComponent(btnRegisterPersonal)
                .addContainerGap(190, Short.MAX_VALUE))
        );

        jTabbedPane1.addTab("Cuenta Personal", jPanel1);

        jPanel3.setBackground(new java.awt.Color(224, 224, 224));

        lblTitle.setFont(new java.awt.Font("Perpetua", 1, 24)); // NOI18N
        lblTitle.setText("REGISTRO DE USUARIO");

        lblType.setFont(new java.awt.Font("Copperplate Gothic Light", 0, 14)); // NOI18N
        lblType.setText("Escoga el tipo de cuenta:");

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(lblType))
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGap(81, 81, 81)
                        .addComponent(lblTitle)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblTitle)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lblType)
                .addContainerGap(7, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jTabbedPane1))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jTabbedPane1)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnRegisterPersonalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRegisterPersonalActionPerformed
        onRegisterPersonal();
    }//GEN-LAST:event_btnRegisterPersonalActionPerformed

    private void btnRegisterCompanyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRegisterCompanyActionPerformed
        onRegisterCompany();
    }//GEN-LAST:event_btnRegisterCompanyActionPerformed

    private void btnCancelCompanyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCancelCompanyActionPerformed
        onCancel();
    }//GEN-LAST:event_btnCancelCompanyActionPerformed

    private void txtPersonalFullNameActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtPersonalFullNameActionPerformed
        // TODO add your handling code here: Validar que halla por lo menos un espacio (Apellido Nombre)
    }//GEN-LAST:event_txtPersonalFullNameActionPerformed

    private void txtCompanyNameMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txtCompanyNameMouseEntered
        txtCompanyName.setToolTipText("El nombre de la compañía solo debe tener letras");
    }//GEN-LAST:event_txtCompanyNameMouseEntered

    private void txtCompanyRucMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txtCompanyRucMouseEntered
        txtCompanyRuc.setToolTipText("El RUC debe contener 13 dígitos y empezar con 001");
    }//GEN-LAST:event_txtCompanyRucMouseEntered

    private void txtPhoneMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txtPhoneMouseEntered
        txtPhone.setToolTipText("El celular debe de tener 10 dígitos");
    }//GEN-LAST:event_txtPhoneMouseEntered

    private void txtEmailMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txtEmailMouseEntered
        txtEmail.setToolTipText("El formato correcto del email: xxx@xx.xx");
    }//GEN-LAST:event_txtEmailMouseEntered

    private void txtCountryMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txtCountryMouseEntered
        // TODO add your handling code here:
    }//GEN-LAST:event_txtCountryMouseEntered

    private void txtPersonalFullNameMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txtPersonalFullNameMouseEntered
        txtPersonalFullName.setToolTipText("Ingrese su nombre y apellido");
    }//GEN-LAST:event_txtPersonalFullNameMouseEntered
    private void resetColors() {
        lblCompanyName.setForeground(DEFAULT_COLOR);
        lblRuc.setForeground(DEFAULT_COLOR);
        lblPhone.setForeground(DEFAULT_COLOR);
        lblEmail.setForeground(DEFAULT_COLOR);
        lblCountry.setForeground(DEFAULT_COLOR);
        lblCity.setForeground(DEFAULT_COLOR);
        jLabel7.setForeground(DEFAULT_COLOR);
        jLabel8.setForeground(DEFAULT_COLOR);
        jLabel9.setForeground(DEFAULT_COLOR);

        lblPersonalFullName.setForeground(DEFAULT_COLOR);
        lblPersonalUser.setForeground(DEFAULT_COLOR);
        lblPersonalPassword.setForeground(DEFAULT_COLOR);
    }

    private void onRegisterPersonal() {
        resetColors();

        String name = getPersonalFullName();
        String username = getPersonalUsername();
        String password = getPersonalPassword();

        String errors = validatePersonalForm(name, username, password);
        if (errors != null) {
            showValidationErrors(errors);
            return;
        }

        String secretKey = controller.authenticatorcontroller.generateAndShowKey(this, username);

        HashMap<String, String> personalData = buildPersonalData(username, password, name);

        personalData.put("twoFactorKey", secretKey);
        boolean success = controller.userController.registerPersonalGUI(personalData);
        handleRegisterResult(success, "Cuenta Personal creada exitosamente!");
    }

    private void onRegisterCompany() {
        resetColors();

        String name = getCompanyName();
        String ruc = getCompanyRuc();
        String phone = getCompanyPhone();
        String email = getCompanyEmail();
        String country = getCountry();
        String city = getCity();
        String street = getStreet();
        String username = getCompanyUsername();
        String password = getCompanyPassword();

        String errors = validateCompanyForm(name, ruc, phone, email, country, city, street, username, password);
        if (errors != null) {
            showValidationErrors(errors);
            return;
        }

        String secretKey = controller.authenticatorcontroller.generateAndShowKey(this, username); 

        HashMap<String, String> companyData = buildCompanyData(username, password, name, ruc, phone, email);

        companyData.put("twoFactorKey", secretKey);

        Address address = new Address(country, city, street);

        boolean success = controller.userController.registerCompanyGUI(companyData, address);
        handleRegisterResult(success, "Cuenta de Empresa creada exitosamente!");
    }

    private void onCancel() {
        this.dispose();
    }

    private String getPersonalFullName() {
        return txtPersonalFullName.getText().trim();
    }

    private String getPersonalUsername() {
        return txtPersonalUserName.getText().trim();
    }

    private String getPersonalPassword() {
        return new String(passPersonalPassword.getPassword());
    }

    private String getCompanyName() {
        return txtCompanyName.getText().trim();
    }

    private String getCompanyRuc() {
        return txtCompanyRuc.getText().trim();
    }

    private String getCompanyPhone() {
        return txtPhone.getText().trim();
    }

    private String getCompanyEmail() {
        return txtEmail.getText().trim();
    }

    private String getCountry() {
        return txtCountry.getText().trim();
    }

    private String getCity() {
        return txtCity.getText().trim();
    }

    private String getStreet() {
        return txtStreet.getText().trim();
    }

    private String getCompanyUsername() {
        return txtCompanyUserName.getText().trim();
    }

    private String getCompanyPassword() {
        return new String(passCompanyPassword.getPassword());
    }

    private String validatePersonalForm(String name, String username, String password) {
        StringBuilder errors = new StringBuilder();

        if (!ValidationUtils.hasTwoWords(name)) {
            lblPersonalFullName.setForeground(ERROR_COLOR);
            errors.append("- El nombre debe contener al menos un Nombre y un Apellido (solo letras).\n");
        }

        if (ValidationUtils.isEmpty(username)) {
            lblPersonalUser.setForeground(ERROR_COLOR);
            errors.append("- El usuario es obligatorio.\n");
        } else if (controller.userController.isUsernameTaken(username)) {
            lblPersonalUser.setForeground(ERROR_COLOR);
            errors.append("- El nombre de usuario '").append(username).append("' ya está en uso.\n");
        }

        if (ValidationUtils.isEmpty(password)) {
            lblPersonalPassword.setForeground(ERROR_COLOR);
            errors.append("- La contraseña es obligatoria.\n");
        }

        return errors.length() > 0 ? errors.toString() : null;
    }

    private String validateCompanyForm(String name, String ruc, String phone, String email,
            String country, String city, String street,
            String username, String password) {

        StringBuilder errors = new StringBuilder();

        if (ValidationUtils.isEmpty(name)) {
            lblCompanyName.setForeground(ERROR_COLOR);
            errors.append("- El nombre de la empresa es obligatorio.\n");
        } else if (!ValidationUtils.isTextOnly(name)) {
            lblCompanyName.setForeground(ERROR_COLOR);
            errors.append("- El nombre de la empresa solo debe contener letras.\n");
        }

        if (!ValidationUtils.isStrictRuc(ruc)) {
            lblRuc.setForeground(ERROR_COLOR);
            errors.append("- El RUC debe tener 13 dígitos numéricos y empezar en '001'.\n");
        }

        if (!ValidationUtils.isValidPhone10Digits(phone)) {
            lblPhone.setForeground(ERROR_COLOR);
            errors.append("- El celular debe tener exactamente 10 dígitos numéricos.\n");
        }

        if (!ValidationUtils.isValidEmail(email)) {
            lblEmail.setForeground(ERROR_COLOR);
            errors.append("- El correo electrónico no es válido (ej: usuario@dominio.com).\n");
        }

        if (ValidationUtils.isEmpty(country) || !ValidationUtils.isTextOnly(country)) {
            lblCountry.setForeground(ERROR_COLOR);
            errors.append("- El país es obligatorio y solo debe contener letras.\n");
        }

        if (ValidationUtils.isEmpty(city) || !ValidationUtils.isTextOnly(city)) {
            lblCity.setForeground(ERROR_COLOR);
            errors.append("- La ciudad es obligatoria y solo debe contener letras.\n");
        }

        if (ValidationUtils.isEmpty(street)) {
            jLabel7.setForeground(ERROR_COLOR);
            errors.append("- La calle es obligatoria.\n");
        }

        if (ValidationUtils.isEmpty(username)) {
            jLabel8.setForeground(ERROR_COLOR);
            errors.append("- El usuario es obligatorio.\n");
        } else if (controller.userController.isUsernameTaken(username)) {
            jLabel8.setForeground(ERROR_COLOR);
            errors.append("- El nombre de usuario '").append(username).append("' ya está en uso.\n");
        }

        if (ValidationUtils.isEmpty(password)) {
            jLabel9.setForeground(ERROR_COLOR);
            errors.append("- La contraseña es obligatoria.\n");
        }

        return errors.length() > 0 ? errors.toString() : null;
    }

    private HashMap<String, String> buildPersonalData(String username, String password, String fullName) {
        HashMap<String, String> personalData = new HashMap<>();
        personalData.put("username", username);
        personalData.put("password", password);
        personalData.put("fullName", fullName);
        return personalData;
    }

    private HashMap<String, String> buildCompanyData(String username, String password,
            String companyName, String ruc,
            String phone, String email) {
        HashMap<String, String> companyData = new HashMap<>();
        companyData.put("username", username);
        companyData.put("password", password);
        companyData.put("companyName", companyName);
        companyData.put("ruc", ruc);
        companyData.put("phone", phone);
        companyData.put("email", email);
        return companyData;
    }

    private void showValidationErrors(String errors) {
        JOptionPane.showMessageDialog(
                this,
                "Por favor corrija los siguientes errores:\n\n" + errors,
                "Error de Validación",
                JOptionPane.WARNING_MESSAGE
        );
    }

    private void handleRegisterResult(boolean success, String successMsg) {
        if (success) {
            JOptionPane.showMessageDialog(this, successMsg);
            this.dispose();
        } else {
            JOptionPane.showMessageDialog(this, "Error al registrar.", "Fallo de Registro", JOptionPane.ERROR_MESSAGE);
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnCancelCompany;
    private javax.swing.JButton btnRegisterCompany;
    private javax.swing.JButton btnRegisterPersonal;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JLabel lblCity;
    private javax.swing.JLabel lblCompanyName;
    private javax.swing.JLabel lblCountry;
    private javax.swing.JLabel lblEmail;
    private javax.swing.JLabel lblPersonalFullName;
    private javax.swing.JLabel lblPersonalPassword;
    private javax.swing.JLabel lblPersonalUser;
    private javax.swing.JLabel lblPhone;
    private javax.swing.JLabel lblRuc;
    private javax.swing.JLabel lblTitle;
    private javax.swing.JLabel lblType;
    private javax.swing.JPasswordField passCompanyPassword;
    private javax.swing.JPasswordField passPersonalPassword;
    private javax.swing.JTextField txtCity;
    private javax.swing.JTextField txtCompanyName;
    private javax.swing.JTextField txtCompanyRuc;
    private javax.swing.JTextField txtCompanyUserName;
    private javax.swing.JTextField txtCountry;
    private javax.swing.JTextField txtEmail;
    private javax.swing.JTextField txtPersonalFullName;
    private javax.swing.JTextField txtPersonalUserName;
    private javax.swing.JTextField txtPhone;
    private javax.swing.JTextField txtStreet;
    // End of variables declaration//GEN-END:variables
}
